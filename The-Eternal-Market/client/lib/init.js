//loads web3
if(typeof web3 === 'undefined')
	    web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'));


//the eternal address
var em_base = '0x389d5Afb6066b2bE961cC5869E94b65B6185331A';

//ABI's for our contracts
var base_contract = web3.eth.contract([{"constant":false,"inputs":[{"name":"_market","type":"address"}],"name":"changeMarketAddress","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_m","type":"address"},{"name":"_d","type":"address"},{"name":"_c","type":"address"}],"name":"setUp","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"database","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_community","type":"address"}],"name":"changeCommunityAddress","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"market","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_database","type":"address"}],"name":"changeDatabaseAddress","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"community","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
var market_contract = web3.eth.contract([{"constant":false,"inputs":[{"name":"_title","type":"string"},{"name":"_description","type":"string"},{"name":"_publicKey","type":"string"},{"name":"_price","type":"uint256"}],"name":"addListing","outputs":[{"name":"","type":"bool"}],"payable":true,"type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"},{"name":"shippingAddress","type":"string"}],"name":"addOrder","outputs":[{"name":"","type":"bool"}],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"listing_rate","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getProfits","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"}],"name":"abortOrder","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"}],"name":"removeListing","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"order_rate","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"original_price","type":"uint256"}],"name":"getListingFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"new_num","type":"uint256"}],"name":"change_bad_seller_threshold","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"eternalAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"}],"name":"disputeOrder","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"},{"name":"newPrice","type":"uint256"}],"name":"changePrice","outputs":[{"name":"","type":"bool"}],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"getCommunity","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"nextListingID","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_id","type":"uint256"}],"name":"isBadListing","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"}],"name":"confirmShipment","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_order","type":"uint256"},{"name":"_listing","type":"uint256"}],"name":"updateRates","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"original_price","type":"uint256"}],"name":"buildOrderFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"nextOrderID","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"bad_seller_threshold","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"}],"name":"confirmDelivery","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getDatabase","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
var database_contract = web3.eth.contract([{"constant":true,"inputs":[],"name":"nextFreeOrderID","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"id","type":"uint256"}],"name":"getListing","outputs":[{"name":"","type":"address"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getNextFreeListingID","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"abortOrder","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"removeListing","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_buyer","type":"address"},{"name":"_seller","type":"address"},{"name":"_shippingAddress","type":"string"},{"name":"_contractAddress","type":"address"},{"name":"_listingID","type":"uint256"}],"name":"addOrder","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"eternalAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"id","type":"uint256"}],"name":"isValidListing","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_seller","type":"address"},{"name":"_title","type":"string"},{"name":"_description","type":"string"},{"name":"_publicKey","type":"string"},{"name":"_price","type":"uint256"}],"name":"addListing","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"disputeOrder","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"orders","outputs":[{"name":"buyer","type":"address"},{"name":"seller","type":"address"},{"name":"shippingAddress","type":"string"},{"name":"contractAddress","type":"address"},{"name":"listingID","type":"uint256"},{"name":"orderStatus","type":"uint256"},{"name":"timeListed","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"},{"name":"newPrice","type":"uint256"}],"name":"changePrice","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"id","type":"uint256"}],"name":"isValidOrder","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getNextFreeOrderID","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"id","type":"uint256"}],"name":"getOrder","outputs":[{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"string"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"listings","outputs":[{"name":"seller","type":"address"},{"name":"title","type":"string"},{"name":"listingDescription","type":"string"},{"name":"publicKey","type":"string"},{"name":"price","type":"uint256"},{"name":"timeListed","type":"uint256"},{"name":"salesSuccessful","type":"uint256"},{"name":"salesDisputed","type":"uint256"},{"name":"lastsuccessfulSale","type":"uint256"},{"name":"enabled","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"confirmShipment","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getMarket","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"nextFreeListingID","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"confirmDelivery","outputs":[],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
var community_contract = web3.eth.contract([{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"proposals","outputs":[{"name":"action","type":"uint256"},{"name":"timeCreated","type":"uint256"},{"name":"reason","type":"string"},{"name":"newAdd","type":"address"},{"name":"listing_id","type":"uint256"},{"name":"executed","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"propID","type":"uint256"}],"name":"executeProposal","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"propID","type":"uint256"}],"name":"hasVotedOn","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"proposalWaitTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"ICO","outputs":[{"name":"","type":"uint256"}],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"sharesOutstanding","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"propID","type":"uint256"}],"name":"currentVotingResults","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"endICO","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"propID","type":"uint256"}],"name":"voteYes","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"action","type":"uint256"},{"name":"reason","type":"string"},{"name":"newAdd","type":"address"},{"name":"listing","type":"uint256"}],"name":"propose","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"sharePrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"contract_address","type":"address"}],"name":"collectProfits","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferShares","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"buy","outputs":[{"name":"","type":"uint256"}],"payable":true,"type":"function"},{"constant":true,"inputs":[{"name":"_address","type":"address"}],"name":"isShareholder","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getProposalsLength","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"id","type":"uint256"}],"name":"getProposal","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"string"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"shares","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"amount","type":"uint256"}],"name":"sell","outputs":[{"name":"revenue","type":"uint256"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"action","type":"string"}],"name":"Action","type":"event"}]);


//load the most recent version of the market
var base = base_contract.at(em_base);
var market_address = base.market();

//connect to our market contract on the ethereum network
EM = market_contract.at(market_address);

//load the current database of listings and orders contract
var database_address = base.database();
DB = database_contract.at(database_address);

//load the current community
var community_address = base.community(); 
CM = community_contract.at(community_address);

//create blank databases to be filled as needed;

OrdersDB = new Mongo.Collection("OrdersDB");
ListingsDB = new Mongo.Collection("ListingsDB");
ProposalsDB = new Mongo.Collection("ProposalsDB");
loadActiveListings();



      

